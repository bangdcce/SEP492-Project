-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.audit_logs (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  actor_id uuid NOT NULL,
  action character varying NOT NULL,
  entity_type character varying NOT NULL,
  entity_id character varying NOT NULL,
  ip_address character varying,
  user_agent text,
  before_data jsonb,
  after_data jsonb,
  created_at timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT audit_logs_pkey PRIMARY KEY (id),
  CONSTRAINT FK_177183f29f438c488b5e8510cdb FOREIGN KEY (actor_id) REFERENCES public.users(id)
);
CREATE TABLE public.auth_sessions (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  userId uuid NOT NULL,
  refreshTokenHash character varying NOT NULL,
  userAgent character varying,
  ipAddress character varying,
  isRevoked boolean NOT NULL DEFAULT false,
  revokedAt timestamp without time zone,
  expiresAt timestamp without time zone NOT NULL,
  createdAt timestamp without time zone NOT NULL DEFAULT now(),
  lastUsedAt timestamp without time zone,
  replacedBySessionId uuid,
  validAccessFrom timestamp without time zone,
  CONSTRAINT auth_sessions_pkey PRIMARY KEY (id),
  CONSTRAINT FK_925b24d7fc2f9324ce972aee025 FOREIGN KEY (userId) REFERENCES public.users(id),
  CONSTRAINT FK_6e11140db54eefb6f4991a40df0 FOREIGN KEY (replacedBySessionId) REFERENCES public.auth_sessions(id)
);
CREATE TABLE public.contracts (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  projectId uuid NOT NULL,
  title character varying,
  contractUrl character varying NOT NULL,
  termsContent text,
  status character varying NOT NULL DEFAULT 'DRAFT'::character varying,
  createdBy uuid NOT NULL,
  createdAt timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT contracts_pkey PRIMARY KEY (id),
  CONSTRAINT FK_2421e3588c8e452a325ca49b70f FOREIGN KEY (projectId) REFERENCES public.projects(id),
  CONSTRAINT FK_754103da22018eef9a0ee6f21e5 FOREIGN KEY (createdBy) REFERENCES public.users(id)
);
CREATE TABLE public.digital_signatures (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  contractId uuid NOT NULL,
  userId uuid NOT NULL,
  signatureHash character varying NOT NULL,
  ipAddress character varying,
  signedAt timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT digital_signatures_pkey PRIMARY KEY (id),
  CONSTRAINT FK_272d16a5c66344d957a1efecb25 FOREIGN KEY (contractId) REFERENCES public.contracts(id),
  CONSTRAINT FK_fda9661a44dca0e61b72fb4680a FOREIGN KEY (userId) REFERENCES public.users(id)
);
CREATE TABLE public.dispute_activities (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  disputeId uuid NOT NULL,
  actorId uuid,
  actorRole USER-DEFINED,
  action USER-DEFINED NOT NULL,
  description character varying,
  metadata jsonb,
  isInternal boolean NOT NULL DEFAULT false,
  timestamp timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT dispute_activities_pkey PRIMARY KEY (id),
  CONSTRAINT FK_6e8e8ceb8825dc4b0f9f53ac650 FOREIGN KEY (disputeId) REFERENCES public.disputes(id),
  CONSTRAINT FK_5cacac4c36fa75db2ecac2d6d2d FOREIGN KEY (actorId) REFERENCES public.users(id)
);
CREATE TABLE public.dispute_notes (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  disputeId uuid NOT NULL,
  authorId uuid NOT NULL,
  authorRole USER-DEFINED NOT NULL,
  content text NOT NULL,
  isInternal boolean NOT NULL DEFAULT false,
  isPinned boolean NOT NULL DEFAULT false,
  noteType character varying NOT NULL DEFAULT 'GENERAL'::character varying,
  attachments jsonb,
  createdAt timestamp without time zone NOT NULL DEFAULT now(),
  updatedAt timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT dispute_notes_pkey PRIMARY KEY (id),
  CONSTRAINT FK_3282d2ccb98a92b5ecbf66adf76 FOREIGN KEY (disputeId) REFERENCES public.disputes(id),
  CONSTRAINT FK_8e5bf63d7e5d911cc06d2a6e05d FOREIGN KEY (authorId) REFERENCES public.users(id)
);
CREATE TABLE public.disputes (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  projectId uuid NOT NULL,
  reason text NOT NULL,
  status USER-DEFINED NOT NULL DEFAULT 'OPEN'::disputes_status_enum,
  resolvedAt timestamp without time zone,
  createdAt timestamp without time zone NOT NULL DEFAULT now(),
  raisedById uuid NOT NULL,
  defendantId uuid NOT NULL,
  evidence jsonb,
  result USER-DEFINED NOT NULL DEFAULT 'PENDING'::disputes_result_enum,
  adminComment text,
  resolvedById uuid,
  updatedAt timestamp without time zone NOT NULL DEFAULT now(),
  raiserRole USER-DEFINED,
  defendantRole USER-DEFINED,
  disputeType USER-DEFINED,
  category USER-DEFINED,
  priority USER-DEFINED NOT NULL DEFAULT 'MEDIUM'::disputes_priority_enum,
  disputedAmount numeric,
  defendantResponse text,
  defendantEvidence jsonb,
  defendantRespondedAt timestamp without time zone,
  responseDeadline timestamp without time zone,
  resolutionDeadline timestamp without time zone,
  isOverdue boolean NOT NULL DEFAULT false,
  parentDisputeId uuid,
  isAppealed boolean NOT NULL DEFAULT false,
  appealReason text,
  appealedAt timestamp without time zone,
  appealResolution text,
  appealResolvedAt timestamp without time zone,
  milestoneId uuid NOT NULL,
  messages text,
  groupId character varying,
  appealResolvedById character varying,
  CONSTRAINT disputes_pkey PRIMARY KEY (id),
  CONSTRAINT FK_9a4ad337edc45133e24c8bcaf4d FOREIGN KEY (projectId) REFERENCES public.projects(id),
  CONSTRAINT FK_8880a40e54bc9b4675323ca102e FOREIGN KEY (raisedById) REFERENCES public.users(id),
  CONSTRAINT FK_bcfa408d5738fa2c2550bc2c073 FOREIGN KEY (defendantId) REFERENCES public.users(id),
  CONSTRAINT FK_00ac6d80806ccdd62cf9c159785 FOREIGN KEY (resolvedById) REFERENCES public.users(id),
  CONSTRAINT FK_7aebab8b5f52cd36df7211844b9 FOREIGN KEY (milestoneId) REFERENCES public.milestones(id),
  CONSTRAINT FK_095c0da1ca820448832b8644d48 FOREIGN KEY (parentDisputeId) REFERENCES public.disputes(id)
);
CREATE TABLE public.documents (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  projectId uuid NOT NULL,
  uploaderId uuid NOT NULL,
  name character varying NOT NULL,
  fileUrl character varying NOT NULL,
  type USER-DEFINED NOT NULL,
  version integer NOT NULL DEFAULT 1,
  description text,
  createdAt timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT documents_pkey PRIMARY KEY (id),
  CONSTRAINT FK_fe6ebd6e679c0feee3a7ecc0354 FOREIGN KEY (projectId) REFERENCES public.projects(id),
  CONSTRAINT FK_befd700a02312da4cc725ccaace FOREIGN KEY (uploaderId) REFERENCES public.users(id)
);
CREATE TABLE public.escrows (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  projectId uuid NOT NULL,
  milestoneId uuid NOT NULL,
  totalAmount numeric NOT NULL,
  fundedAmount numeric NOT NULL DEFAULT '0'::numeric,
  releasedAmount numeric NOT NULL DEFAULT '0'::numeric,
  developerShare numeric NOT NULL,
  brokerShare numeric NOT NULL DEFAULT '0'::numeric,
  platformFee numeric NOT NULL DEFAULT '0'::numeric,
  developerPercentage numeric NOT NULL DEFAULT '85'::numeric,
  brokerPercentage numeric NOT NULL DEFAULT '10'::numeric,
  platformPercentage numeric NOT NULL DEFAULT '5'::numeric,
  currency character varying NOT NULL DEFAULT 'VND'::character varying,
  status USER-DEFINED NOT NULL DEFAULT 'PENDING'::escrows_status_enum,
  fundedAt timestamp without time zone,
  releasedAt timestamp without time zone,
  refundedAt timestamp without time zone,
  clientApproved boolean NOT NULL DEFAULT false,
  clientApprovedAt timestamp without time zone,
  clientWalletId uuid,
  developerWalletId uuid,
  brokerWalletId uuid,
  holdTransactionId uuid,
  releaseTransactionIds jsonb,
  refundTransactionId uuid,
  disputeId uuid,
  notes text,
  createdAt timestamp without time zone NOT NULL DEFAULT now(),
  updatedAt timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT escrows_pkey PRIMARY KEY (id),
  CONSTRAINT FK_f07f9d851481059289600bc4128 FOREIGN KEY (projectId) REFERENCES public.projects(id),
  CONSTRAINT FK_54b1af06e01e858558a708d47cb FOREIGN KEY (milestoneId) REFERENCES public.milestones(id),
  CONSTRAINT FK_08723ed58ba58a217b8713f531d FOREIGN KEY (disputeId) REFERENCES public.disputes(id)
);
CREATE TABLE public.fee_configs (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  feeType USER-DEFINED NOT NULL,
  percentage numeric NOT NULL,
  minAmount numeric,
  maxAmount numeric,
  description character varying,
  isActive boolean NOT NULL DEFAULT true,
  effectiveFrom timestamp without time zone,
  effectiveTo timestamp without time zone,
  updatedBy uuid,
  createdAt timestamp without time zone NOT NULL DEFAULT now(),
  updatedAt timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT fee_configs_pkey PRIMARY KEY (id),
  CONSTRAINT FK_42214cd963e2591ef028f0ebdd9 FOREIGN KEY (updatedBy) REFERENCES public.users(id)
);
CREATE TABLE public.kyc_verifications (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  userId uuid NOT NULL,
  fullNameOnDocument character varying NOT NULL,
  documentNumber character varying NOT NULL,
  documentType USER-DEFINED NOT NULL DEFAULT 'CCCD'::kyc_verifications_documenttype_enum,
  dateOfBirth date,
  documentExpiryDate date,
  documentFrontUrl character varying NOT NULL,
  documentBackUrl character varying NOT NULL,
  selfieUrl character varying NOT NULL,
  status USER-DEFINED NOT NULL DEFAULT 'PENDING'::kyc_verifications_status_enum,
  rejectionReason text,
  reviewedBy uuid,
  reviewedAt timestamp without time zone,
  createdAt timestamp without time zone NOT NULL DEFAULT now(),
  updatedAt timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT kyc_verifications_pkey PRIMARY KEY (id),
  CONSTRAINT FK_f71e34495dae27087b5773b35b4 FOREIGN KEY (userId) REFERENCES public.users(id),
  CONSTRAINT FK_a62a22506fed8625d73996501b3 FOREIGN KEY (reviewedBy) REFERENCES public.users(id)
);
CREATE TABLE public.migrations (
  id integer NOT NULL DEFAULT nextval('migrations_id_seq'::regclass),
  timestamp bigint NOT NULL,
  name character varying NOT NULL,
  CONSTRAINT migrations_pkey PRIMARY KEY (id)
);
CREATE TABLE public.milestone_payments (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  milestoneId uuid NOT NULL,
  holdTransactionId uuid,
  releaseTransactionId uuid,
  CONSTRAINT milestone_payments_pkey PRIMARY KEY (id),
  CONSTRAINT FK_820aa06a348b448f9b6a8c52ad5 FOREIGN KEY (milestoneId) REFERENCES public.milestones(id),
  CONSTRAINT FK_78f7c3195dff24da67bb49b29d5 FOREIGN KEY (holdTransactionId) REFERENCES public.transactions(id),
  CONSTRAINT FK_372e96a14c5f890c42b0d6e58e0 FOREIGN KEY (releaseTransactionId) REFERENCES public.transactions(id)
);
CREATE TABLE public.milestones (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  projectId uuid NOT NULL,
  title character varying NOT NULL,
  description text,
  amount numeric NOT NULL,
  startDate timestamp without time zone,
  dueDate timestamp without time zone,
  status USER-DEFINED NOT NULL DEFAULT 'PENDING'::milestones_status_enum,
  proofOfWork character varying,
  feedback text,
  sortOrder integer,
  createdAt timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT milestones_pkey PRIMARY KEY (id),
  CONSTRAINT FK_662a1f9d865fe49768fa369fd0f FOREIGN KEY (projectId) REFERENCES public.projects(id)
);
CREATE TABLE public.notifications (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  userId uuid NOT NULL,
  title character varying NOT NULL,
  body text NOT NULL,
  isRead boolean NOT NULL DEFAULT false,
  readAt timestamp without time zone,
  relatedType character varying,
  relatedId character varying,
  createdAt timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT notifications_pkey PRIMARY KEY (id),
  CONSTRAINT FK_692a909ee0fa9383e7859f9b406 FOREIGN KEY (userId) REFERENCES public.users(id)
);
CREATE TABLE public.payout_methods (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  userId uuid NOT NULL,
  bankName character varying NOT NULL,
  bankCode character varying,
  accountNumber character varying NOT NULL,
  accountHolderName character varying NOT NULL,
  branchName character varying,
  isDefault boolean NOT NULL DEFAULT false,
  isVerified boolean NOT NULL DEFAULT false,
  verifiedAt timestamp without time zone,
  createdAt timestamp without time zone NOT NULL DEFAULT now(),
  updatedAt timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT payout_methods_pkey PRIMARY KEY (id),
  CONSTRAINT FK_372920d813ceab29336fc5221e6 FOREIGN KEY (userId) REFERENCES public.users(id)
);
CREATE TABLE public.payout_requests (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  walletId uuid NOT NULL,
  amount numeric NOT NULL,
  status USER-DEFINED NOT NULL DEFAULT 'PENDING'::payout_requests_status_enum,
  requestedAt timestamp without time zone NOT NULL DEFAULT now(),
  processedAt timestamp without time zone,
  processedBy uuid,
  note text,
  payoutMethodId uuid NOT NULL,
  fee numeric NOT NULL DEFAULT '0'::numeric,
  netAmount numeric NOT NULL,
  currency character varying NOT NULL DEFAULT 'VND'::character varying,
  approvedAt timestamp without time zone,
  approvedBy uuid,
  rejectedAt timestamp without time zone,
  rejectedBy character varying,
  rejectionReason text,
  externalReference character varying,
  transactionId uuid,
  adminNote text,
  updatedAt timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT payout_requests_pkey PRIMARY KEY (id),
  CONSTRAINT FK_7ecca99cfa68cbb2bfade96cd05 FOREIGN KEY (walletId) REFERENCES public.wallets(id),
  CONSTRAINT FK_2efebf9c50eb838dd24d5816cc5 FOREIGN KEY (processedBy) REFERENCES public.users(id),
  CONSTRAINT FK_90c93283fb9c279f41bcde3c51f FOREIGN KEY (payoutMethodId) REFERENCES public.payout_methods(id),
  CONSTRAINT FK_8f9cb3fd93e7a728acf64f61930 FOREIGN KEY (transactionId) REFERENCES public.transactions(id),
  CONSTRAINT FK_b52c23ed48d02fb1fe17449d2d6 FOREIGN KEY (approvedBy) REFERENCES public.users(id)
);
CREATE TABLE public.platform_settings (
  key character varying NOT NULL,
  value jsonb NOT NULL,
  updatedAt timestamp without time zone NOT NULL DEFAULT now(),
  updatedBy uuid,
  CONSTRAINT platform_settings_pkey PRIMARY KEY (key),
  CONSTRAINT FK_bf32a1bcd51436a0b202a00a834 FOREIGN KEY (updatedBy) REFERENCES public.users(id)
);
CREATE TABLE public.profiles (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  userId uuid NOT NULL UNIQUE,
  bio text,
  companyName character varying,
  skills ARRAY,
  portfolioLinks jsonb,
  bankInfo jsonb,
  avatarUrl character varying,
  CONSTRAINT profiles_pkey PRIMARY KEY (id),
  CONSTRAINT FK_315ecd98bd1a42dcf2ec4e2e985 FOREIGN KEY (userId) REFERENCES public.users(id)
);
CREATE TABLE public.project_categories (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  name character varying NOT NULL,
  slug character varying UNIQUE,
  createdAt timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT project_categories_pkey PRIMARY KEY (id)
);
CREATE TABLE public.project_category_map (
  project_id uuid NOT NULL,
  category_id uuid NOT NULL,
  CONSTRAINT project_category_map_pkey PRIMARY KEY (project_id, category_id),
  CONSTRAINT FK_63d1dc4e442a80233613bc0d154 FOREIGN KEY (project_id) REFERENCES public.projects(id),
  CONSTRAINT FK_02daa0e833626078f4b5c608ef7 FOREIGN KEY (category_id) REFERENCES public.project_categories(id)
);
CREATE TABLE public.project_request_answers (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  requestId uuid NOT NULL,
  valueText text,
  questionId integer NOT NULL,
  optionId integer,
  CONSTRAINT project_request_answers_pkey PRIMARY KEY (id),
  CONSTRAINT FK_f80351df95d44f963e86f1c8d92 FOREIGN KEY (requestId) REFERENCES public.project_requests(id),
  CONSTRAINT FK_bd1b708124a60b84cddb67a9fef FOREIGN KEY (questionId) REFERENCES public.wizard_questions(id),
  CONSTRAINT FK_9e7d84f4f6c8c98fa0b733c5d5e FOREIGN KEY (optionId) REFERENCES public.wizard_options(id)
);
CREATE TABLE public.project_request_proposals (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  requestId uuid NOT NULL,
  freelancerId uuid NOT NULL,
  brokerId uuid,
  proposedBudget numeric,
  estimatedDuration character varying,
  coverLetter text,
  status character varying NOT NULL DEFAULT 'PENDING'::character varying,
  createdAt timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT project_request_proposals_pkey PRIMARY KEY (id),
  CONSTRAINT FK_a3e8fc57db73e22a5128c22e6c7 FOREIGN KEY (requestId) REFERENCES public.project_requests(id),
  CONSTRAINT FK_3a404d4e7ec6b5db69aa875cbf8 FOREIGN KEY (freelancerId) REFERENCES public.users(id),
  CONSTRAINT FK_36541dd025948b388251c3c01f4 FOREIGN KEY (brokerId) REFERENCES public.users(id)
);
CREATE TABLE public.project_requests (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  clientId uuid NOT NULL,
  title character varying NOT NULL,
  description text NOT NULL,
  budgetRange character varying,
  intendedTimeline character varying,
  techPreferences character varying,
  status USER-DEFINED NOT NULL DEFAULT 'PENDING'::project_requests_status_enum,
  brokerId uuid,
  createdAt timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT project_requests_pkey PRIMARY KEY (id),
  CONSTRAINT FK_e207c2a029bb73b35ad1453426a FOREIGN KEY (clientId) REFERENCES public.users(id),
  CONSTRAINT FK_ba91413ed0daddd79814a09ef4d FOREIGN KEY (brokerId) REFERENCES public.users(id)
);
CREATE TABLE public.projects (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  requestId uuid,
  clientId uuid NOT NULL,
  brokerId uuid NOT NULL,
  freelancerId uuid,
  title character varying NOT NULL,
  description text NOT NULL,
  totalBudget numeric NOT NULL,
  currency character varying NOT NULL DEFAULT 'VND'::character varying,
  pricingModel USER-DEFINED,
  startDate timestamp without time zone,
  endDate timestamp without time zone,
  status USER-DEFINED NOT NULL DEFAULT 'PLANNING'::projects_status_enum,
  createdAt timestamp without time zone NOT NULL DEFAULT now(),
  updatedAt timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT projects_pkey PRIMARY KEY (id),
  CONSTRAINT FK_026902dba3d3ceefa3817500674 FOREIGN KEY (requestId) REFERENCES public.project_requests(id),
  CONSTRAINT FK_091f9433895a53408cb8ae3864f FOREIGN KEY (clientId) REFERENCES public.users(id),
  CONSTRAINT FK_8c56501d961c9f7b440abdce5d5 FOREIGN KEY (brokerId) REFERENCES public.users(id),
  CONSTRAINT FK_22f434063fa3502539bab88858d FOREIGN KEY (freelancerId) REFERENCES public.users(id)
);
CREATE TABLE public.reports (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  reporter_id uuid NOT NULL,
  review_id uuid NOT NULL,
  reason USER-DEFINED NOT NULL,
  description text,
  status USER-DEFINED NOT NULL DEFAULT 'PENDING'::reports_status_enum,
  resolved_by uuid,
  admin_note text,
  created_at timestamp without time zone NOT NULL DEFAULT now(),
  resolved_at timestamp without time zone,
  CONSTRAINT reports_pkey PRIMARY KEY (id),
  CONSTRAINT FK_9459b9bf907a3807ef7143d2ead FOREIGN KEY (reporter_id) REFERENCES public.users(id),
  CONSTRAINT FK_628fb90b2d3a87f2bb236befa66 FOREIGN KEY (review_id) REFERENCES public.reviews(id),
  CONSTRAINT FK_f7790853594bca5892d390e1daf FOREIGN KEY (resolved_by) REFERENCES public.users(id)
);
CREATE TABLE public.reviews (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  projectId uuid NOT NULL,
  reviewerId uuid NOT NULL,
  targetUserId uuid NOT NULL,
  rating integer NOT NULL,
  comment text,
  weight numeric NOT NULL DEFAULT '1'::numeric,
  createdAt timestamp without time zone NOT NULL DEFAULT now(),
  updatedAt timestamp without time zone NOT NULL DEFAULT now(),
  deleted_at timestamp without time zone,
  deleted_by uuid,
  delete_reason text,
  CONSTRAINT reviews_pkey PRIMARY KEY (id),
  CONSTRAINT FK_ee90086bb783380da5453d240b9 FOREIGN KEY (projectId) REFERENCES public.projects(id),
  CONSTRAINT FK_f9238c3e3739dc40322f577fc46 FOREIGN KEY (reviewerId) REFERENCES public.users(id),
  CONSTRAINT FK_299e0ce9838de08dea4eac93e28 FOREIGN KEY (targetUserId) REFERENCES public.users(id)
);
CREATE TABLE public.saved_freelancers (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  clientId uuid NOT NULL,
  freelancerId uuid NOT NULL,
  createdAt timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT saved_freelancers_pkey PRIMARY KEY (id),
  CONSTRAINT FK_66a3a09dc240f9edd007d8294b1 FOREIGN KEY (clientId) REFERENCES public.users(id),
  CONSTRAINT FK_32d1522472855a34af369949ad9 FOREIGN KEY (freelancerId) REFERENCES public.users(id)
);
CREATE TABLE public.social_accounts (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  userId uuid NOT NULL,
  provider character varying NOT NULL,
  providerId character varying NOT NULL,
  email character varying,
  avatarUrl text,
  payload jsonb,
  createdAt timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT social_accounts_pkey PRIMARY KEY (id),
  CONSTRAINT FK_7de933c3670ec71c68aca0afd56 FOREIGN KEY (userId) REFERENCES public.users(id)
);
CREATE TABLE public.tasks (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  milestoneId uuid NOT NULL,
  projectId uuid NOT NULL,
  title character varying NOT NULL,
  description text,
  status USER-DEFINED NOT NULL DEFAULT 'TODO'::tasks_status_enum,
  assignedTo uuid,
  dueDate timestamp without time zone,
  sortOrder integer,
  createdAt timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT tasks_pkey PRIMARY KEY (id),
  CONSTRAINT FK_6dc5020fc4c6814347816455e7a FOREIGN KEY (milestoneId) REFERENCES public.milestones(id),
  CONSTRAINT FK_e08fca67ca8966e6b9914bf2956 FOREIGN KEY (projectId) REFERENCES public.projects(id),
  CONSTRAINT FK_3b34ce2db713f0be359768db816 FOREIGN KEY (assignedTo) REFERENCES public.users(id)
);
CREATE TABLE public.transactions (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  walletId uuid NOT NULL,
  amount numeric NOT NULL,
  type USER-DEFINED NOT NULL,
  status USER-DEFINED NOT NULL DEFAULT 'PENDING'::transactions_status_enum,
  createdAt timestamp without time zone NOT NULL DEFAULT now(),
  fee numeric NOT NULL DEFAULT '0'::numeric,
  netAmount numeric,
  currency character varying NOT NULL DEFAULT 'VND'::character varying,
  paymentMethod character varying,
  externalTransactionId character varying,
  metadata jsonb,
  description text,
  failureReason text,
  balanceAfter numeric,
  initiatedBy character varying,
  ipAddress character varying,
  relatedTransactionId uuid,
  completedAt timestamp without time zone,
  referenceType character varying,
  referenceId uuid,
  CONSTRAINT transactions_pkey PRIMARY KEY (id),
  CONSTRAINT FK_a88f466d39796d3081cf96e1b66 FOREIGN KEY (walletId) REFERENCES public.wallets(id)
);
CREATE TABLE public.trust_score_history (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  userId uuid NOT NULL,
  ratingScore numeric,
  behaviorScore numeric,
  disputeScore numeric,
  verificationScore numeric,
  totalScore numeric,
  calculatedAt timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT trust_score_history_pkey PRIMARY KEY (id),
  CONSTRAINT FK_6d46e08df04dfeb9f4311df2378 FOREIGN KEY (userId) REFERENCES public.users(id)
);
CREATE TABLE public.user_flags (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  userId uuid NOT NULL,
  type character varying NOT NULL,
  severity integer NOT NULL DEFAULT 1,
  description text NOT NULL,
  createdAt timestamp without time zone NOT NULL DEFAULT now(),
  status USER-DEFINED NOT NULL DEFAULT 'ACTIVE'::user_flags_status_enum,
  metadata jsonb,
  isAutoGenerated boolean NOT NULL DEFAULT false,
  adminNote text,
  resolution text,
  createdById uuid,
  resolvedById uuid,
  resolvedAt timestamp without time zone,
  appealReason text,
  appealEvidence jsonb,
  appealedAt timestamp without time zone,
  appealResolution text,
  appealResolvedById uuid,
  appealResolvedAt timestamp without time zone,
  expiresAt timestamp without time zone,
  updatedAt timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT user_flags_pkey PRIMARY KEY (id),
  CONSTRAINT FK_87be2c376b9c867c1e12916c2af FOREIGN KEY (userId) REFERENCES public.users(id),
  CONSTRAINT FK_8947514bed8a3f78d16d6ac3f7e FOREIGN KEY (createdById) REFERENCES public.users(id),
  CONSTRAINT FK_6a27efdb19b62bdd218c689108a FOREIGN KEY (resolvedById) REFERENCES public.users(id),
  CONSTRAINT FK_ba9ed3cec568084e68b8cb382a8 FOREIGN KEY (appealResolvedById) REFERENCES public.users(id)
);
CREATE TABLE public.user_tokens (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  userId uuid NOT NULL,
  type USER-DEFINED NOT NULL,
  tokenHash character varying NOT NULL,
  status USER-DEFINED NOT NULL DEFAULT 'PENDING'::user_tokens_status_enum,
  maxUses integer NOT NULL DEFAULT 1,
  useCount integer NOT NULL DEFAULT 0,
  expiresAt timestamp without time zone NOT NULL,
  usedAt timestamp without time zone,
  createdIp character varying,
  lastUsedIp character varying,
  lastUsedUserAgent character varying,
  createdAt timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT user_tokens_pkey PRIMARY KEY (id),
  CONSTRAINT FK_92ce9a299624e4c4ffd99b645b6 FOREIGN KEY (userId) REFERENCES public.users(id)
);
CREATE TABLE public.users (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  email character varying NOT NULL UNIQUE,
  passwordHash character varying,
  fullName character varying NOT NULL,
  role USER-DEFINED NOT NULL DEFAULT 'CLIENT'::users_role_enum,
  phoneNumber character varying,
  isVerified boolean NOT NULL DEFAULT false,
  currentTrustScore numeric NOT NULL DEFAULT '0'::numeric,
  createdAt timestamp without time zone NOT NULL DEFAULT now(),
  updatedAt timestamp without time zone NOT NULL DEFAULT now(),
  totalProjectsFinished integer NOT NULL DEFAULT 0,
  totalProjectsCancelled integer NOT NULL DEFAULT 0,
  totalDisputesLost integer NOT NULL DEFAULT 0,
  totalLateProjects integer NOT NULL DEFAULT 0,
  resetpasswordotp character varying,
  resetpasswordotpexpires timestamp without time zone,
  CONSTRAINT users_pkey PRIMARY KEY (id)
);
CREATE TABLE public.verification_documents (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  userId uuid NOT NULL,
  docType character varying,
  documentUrl character varying NOT NULL,
  status USER-DEFINED NOT NULL DEFAULT 'PENDING'::verification_documents_status_enum,
  submittedAt timestamp without time zone NOT NULL DEFAULT now(),
  verifiedAt timestamp without time zone,
  verifiedBy uuid,
  rejectReason text,
  CONSTRAINT verification_documents_pkey PRIMARY KEY (id),
  CONSTRAINT FK_e3acb36093f2773ea7893b4c972 FOREIGN KEY (userId) REFERENCES public.users(id),
  CONSTRAINT FK_fc6a9c92a9cc696671c2561b73e FOREIGN KEY (verifiedBy) REFERENCES public.users(id)
);
CREATE TABLE public.wallets (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  userId uuid NOT NULL,
  balance numeric NOT NULL DEFAULT '0'::numeric,
  createdAt timestamp without time zone NOT NULL DEFAULT now(),
  pendingBalance numeric NOT NULL DEFAULT '0'::numeric,
  heldBalance numeric NOT NULL DEFAULT '0'::numeric,
  totalDeposited numeric NOT NULL DEFAULT '0'::numeric,
  totalWithdrawn numeric NOT NULL DEFAULT '0'::numeric,
  totalEarned numeric NOT NULL DEFAULT '0'::numeric,
  totalSpent numeric NOT NULL DEFAULT '0'::numeric,
  status USER-DEFINED NOT NULL DEFAULT 'ACTIVE'::wallets_status_enum,
  updatedAt timestamp without time zone NOT NULL DEFAULT now(),
  currency character varying NOT NULL DEFAULT 'VND'::character varying,
  CONSTRAINT wallets_pkey PRIMARY KEY (id),
  CONSTRAINT FK_2ecdb33f23e9a6fc392025c0b97 FOREIGN KEY (userId) REFERENCES public.users(id)
);
CREATE TABLE public.wizard_options (
  id integer NOT NULL DEFAULT nextval('wizard_options_id_seq'::regclass),
  question_id integer NOT NULL,
  value character varying NOT NULL,
  label text NOT NULL,
  sort_order integer,
  CONSTRAINT wizard_options_pkey PRIMARY KEY (id),
  CONSTRAINT FK_bc14ab4d06540c3bd1e408729e3 FOREIGN KEY (question_id) REFERENCES public.wizard_questions(id)
);
CREATE TABLE public.wizard_questions (
  id integer NOT NULL DEFAULT nextval('wizard_questions_id_seq'::regclass),
  code character varying NOT NULL UNIQUE,
  label text NOT NULL,
  help_text text,
  input_type character varying,
  is_active boolean NOT NULL DEFAULT true,
  sort_order integer,
  created_at timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT wizard_questions_pkey PRIMARY KEY (id)
);